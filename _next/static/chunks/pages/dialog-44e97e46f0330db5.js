(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[11],{43:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dialog",function(){return n(7770)}])},7770:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return w}});var a=n(5893),l=n(5838),o=n(6439),i=n(7294),r=n(9840);let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),d=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((e,t,n)=>!!e&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim()};var x={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let c=(0,i.forwardRef)((e,t)=>{var{color:n="currentColor",size:a=24,strokeWidth:s=2,absoluteStrokeWidth:c,className:p="",children:g,iconNode:h}=e,u=(0,r._)(e,["color","size","strokeWidth","absoluteStrokeWidth","className","children","iconNode"]);return(0,i.createElement)("svg",(0,l._)((0,o._)((0,l._)({ref:t},x),{width:a,height:a,stroke:n,strokeWidth:c?24*Number(s)/Number(a):s,className:d("lucide",p)}),u),[...h.map(e=>{let[t,n]=e;return(0,i.createElement)(t,n)}),...Array.isArray(g)?g:[g]])}),p=(e,t)=>{let n=(0,i.forwardRef)((n,a)=>{var{className:o}=n,x=(0,r._)(n,["className"]);return(0,i.createElement)(c,(0,l._)({ref:a,iconNode:t,className:d("lucide-".concat(s(e)),o)},x))});return n.displayName="".concat(e),n},g=p("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),h=p("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),u=p("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),m=p("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),f=p("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),y={dialog:{page:[]}},v=()=>{let e={x:0,y:0,scale:1};return{toString:()=>"translate(".concat(e.x,",").concat(e.y,") scale(").concat(e.scale,")"),applyToPoint:t=>({x:(t.x-e.x)/e.scale,y:(t.y-e.y)/e.scale}),updatePan:(t,n)=>{e.x+=t,e.y+=n},updateZoom:(t,n)=>{let a=e.scale;e.scale*=t,e.x=n.x-(n.x-e.x)*(e.scale/a),e.y=n.y-(n.y-e.y)*(e.scale/a)},reset:()=>{e.x=0,e.y=0,e.scale=1},get:()=>(0,l._)({},e)}},b='<dialog>\n    <page id="start">\n        <text>\n            The quick brown fox\n            jumps over the lazy dog!\n            ... Or, does it?\n        </text>\n        <options>\n            <option text="Yes" next="page_yes"/>\n            <option text="No" next="page_no"/>\n        </options>\n    </page>\n\n    <page id="page_yes">\n        <text>\n            THE QUICK BROWN FOX\n            JUMPS OVER THE LAZY DOG!\n            ... YES, IT DOES!\n        </text>\n        <next>alphabet_upper</next>\n    </page>\n\n    <page id="page_no">\n        <text>\n            THE QUICK BROWN FOX\n            JUMPS OVER THE LAZY DOG!\n            ... NOPE!\n        </text>\n        <next>alphabet_upper</next>\n    </page>\n\n    <page id="alphabet_upper">\n        <text>\n            ABCDEFGHIJKLM\n            NOPQRSTUVWXYZ\n        </text>\n        <options>\n            <option text="Lower" next="alphabet_lower"/>\n            <option text="Mixed" next="alphabet_mixed"/>\n        </options>\n    </page>\n\n    <page id="alphabet_lower">\n        <text>\n            abcdefghijklm\n            nopqrstuvwxyz\n        </text>\n        <next>exit</next>\n    </page>\n\n    <page id="alphabet_mixed">\n        <text>\n            AbCdEfGhIjKlM\n            nOpQrStUvWxYz\n        </text>\n        <options>\n            <option text="More" next="alphabet_mixed_alt"/>\n            <option text="Leave" next="exit"/>\n        </options>\n    </page>\n\n    <page id="alphabet_mixed_alt">\n        <text>\n            aBcDeFgHiJkLm\n            NoPqRsTuVwXyZ\n        </text>\n        <next>exit</next>\n    </page>\n</dialog>';function j(){let[e,t]=(0,i.useState)(y),[n,r]=(0,i.useState)(null),[s,d]=(0,i.useState)(b),[x,c]=(0,i.useState)(!1),[p,j]=(0,i.useState)(!1),[w,N]=(0,i.useState)({nodes:[],edges:[]}),[k,_]=(0,i.useState)(null),E=(0,i.useRef)(null),M=(0,i.useRef)(v());(0,i.useEffect)(()=>{S(b)},[]);let S=e=>{let a=new DOMParser().parseFromString(e,"application/xml"),l=a.querySelector("parsererror");if(l){console.error("XML parsing error:",l);return}let o=Array.from(a.querySelectorAll("page")).map(e=>{var t,n;let a=e.getAttribute("id")||"",l=e.querySelector("text"),o=l&&(null===(t=l.textContent)||void 0===t?void 0:t.trim())||"",i=e.querySelector("next"),r=i&&(null===(n=i.textContent)||void 0===n?void 0:n.trim())||null,s=Array.from(e.querySelectorAll("option")).map(e=>({text:e.getAttribute("text")||"",next:e.getAttribute("next")||""}));return{id:a,text:o,next:r,options:s.length>0?s:null}});t({dialog:{page:o}}),o.length>0&&!n&&r(o[0].id)},C=()=>{let t="<dialog>\n";return e.dialog.page.forEach(e=>{t+='    <page id="'.concat(e.id,'">\n')+"        <text>\n            ".concat(e.text,"\n        </text>\n"),e.options&&e.options.length>0?(t+="        <options>\n",e.options.forEach(e=>{t+='            <option text="'.concat(e.text,'" next="').concat(e.next,'"/>\n')}),t+="        </options>\n"):e.next&&(t+="        <next>".concat(e.next,"</next>\n")),t+="    </page>\n\n"}),t+="</dialog>"},O=()=>{if(!e.dialog.page||0===e.dialog.page.length)return;let t=new Map;e.dialog.page.forEach((e,n)=>{t.set(e.id,n)});let n={nodes:e.dialog.page.map((e,t)=>({id:e.id,index:t,nextNodes:[],level:0,position:{x:0,y:0}})),edges:[]};e.dialog.page.forEach((e,a)=>{if(e.next){let l=t.get(e.next);void 0!==l&&(n.nodes[a].nextNodes.push(l),n.edges.push({from:a,to:l,text:null}))}e.options&&e.options.forEach(e=>{if(e.next){let l=t.get(e.next);void 0!==l&&(n.nodes[a].nextNodes.push(l),n.edges.push({from:a,to:l,text:e.text}))}})});let a=new Set,l=new Set;function o(e,t){if(a.has(e)||l.has(e))return;l.add(e);let i=n.nodes[e];i.level=Math.max(i.level,t),i.nextNodes.forEach(e=>{o(e,t+1)}),l.delete(e),a.add(e)}let i=new Set(n.edges.map(e=>e.to)),r=n.nodes.map((e,t)=>t).filter(e=>!i.has(e));0===r.length&&n.nodes.length>0?o(0,0):r.forEach(e=>o(e,0));let s={},d={};n.nodes.forEach(e=>{s[e.level]=(s[e.level]||0)+1,d[e.level]=d[e.level]||0}),n.nodes.sort((e,t)=>e.level!==t.level?e.level-t.level:e.index-t.index),n.nodes.forEach(e=>{let t=d[e.level]||0,n=s[e.level]||1;e.position={x:-(200*n+(n-1)*60)/2+260*t,y:220*e.level},d[e.level]=t+1});let x=n.nodes.map((t,n)=>({id:e.dialog.page[t.index].id,index:t.index,text:e.dialog.page[t.index].text,x:t.position.x,y:t.position.y,width:200,height:120})),c=n.edges.map(e=>{let t=x.find(t=>t.index===e.from),n=x.find(t=>t.index===e.to);if(!t||!n)return null;let a={x:t.x+100,y:t.y+120},l={x:n.x+100,y:n.y};return{from:t.id,to:n.id,text:e.text,start:a,end:l,controlPoint:{x:(a.x+l.x)/2,y:a.y+(l.y-a.y)/2}}}).filter(Boolean);N({nodes:x,edges:c})};(0,i.useEffect)(()=>{Object.keys(e).length>0&&(d(C()),c(!0),O())},[e]);let P=()=>{_(null)},T=e=>{t(t=>({dialog:{page:t.dialog.page.map(t=>t.id===n?(0,o._)((0,l._)({},t),{text:e}):t)}}))},A=e=>{t(t=>({dialog:{page:t.dialog.page.map(t=>t.id===n?(0,o._)((0,l._)({},t),{next:e}):t)}}))},L=()=>{t(e=>({dialog:{page:e.dialog.page.map(e=>{if(e.id===n){let t=e.options||[];return(0,o._)((0,l._)({},e),{options:[...t,{text:"New Option",next:""}],next:null})}return e})}}))},D=(e,a,i)=>{t(t=>({dialog:{page:t.dialog.page.map(t=>{if(t.id===n&&t.options){let n=[...t.options];return n[e]=(0,o._)((0,l._)({},n[e]),{[a]:i}),(0,o._)((0,l._)({},t),{options:n})}return t})}}))},R=e=>{t(t=>({dialog:{page:t.dialog.page.map(t=>{if(t.id===n&&t.options){let n=t.options.filter((t,n)=>n!==e);return(0,o._)((0,l._)({},t),{options:n.length>0?n:null})}return t})}}))},X=a=>{if(e.dialog.page.length<=1){alert("Cannot delete the last page");return}if(t(e=>{let t=e.dialog.page.filter(e=>e.id!==a);return t.forEach(e=>{e.next===a&&(e.next=""),e.options&&e.options.forEach(e=>{e.next===a&&(e.next="")})}),{dialog:{page:t}}}),n===a){var l;r(null===(l=e.dialog.page[0])||void 0===l?void 0:l.id),j(!1)}},Y=(n,a)=>{if(n!==a){if(e.dialog.page.some(e=>e.id===a)){alert('Page ID "'.concat(a,'" already exists'));return}t(e=>{let t=e.dialog.page.map(e=>e.id===n?(0,o._)((0,l._)({},e),{id:a}):e);return t.forEach(e=>{e.next===n&&(e.next=a),e.options&&e.options.forEach(e=>{e.next===n&&(e.next=a)})}),{dialog:{page:t}}}),r(a)}},W=e.dialog.page.find(e=>e.id===n)||null;return(0,a.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,a.jsx)("header",{className:"bg-gray-800 text-white p-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h1",{className:"text-xl font-bold",children:"Dialog Flowchart Editor"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)("button",{onClick:()=>{M.current.reset(),N(e=>(0,l._)({},e))},className:"bg-gray-600 hover:bg-gray-700 px-3 py-1 rounded flex items-center",children:[(0,a.jsx)(g,{className:"w-4 h-4 mr-1"}),"Reset View"]}),(0,a.jsxs)("button",{onClick:()=>{let n=e.dialog.page.map(e=>e.id),a="new_page",l=1;for(;n.includes(a);)a="new_page_".concat(l),l++;let o={id:a,text:"New page text",next:null,options:null};t(e=>({dialog:{page:[...e.dialog.page,o]}})),r(a),j(!0)},className:"bg-green-600 hover:bg-green-700 px-3 py-1 rounded flex items-center",children:[(0,a.jsx)(h,{className:"w-4 h-4 mr-1"}),"Add Page"]}),(0,a.jsxs)("button",{onClick:()=>{let e=new Blob([C()],{type:"application/xml"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="dialog.xml",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t),c(!1)},className:"bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded flex items-center",children:[(0,a.jsx)(u,{className:"w-4 h-4 mr-1"}),x?"Save*":"Save"]})]})]})}),(0,a.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,a.jsx)("div",{className:"flex-1 bg-gray-100 overflow-hidden",children:(0,a.jsx)("svg",{ref:E,className:"w-full h-full",onMouseDown:e=>{var t;if(0!==e.button)return;let n=E.current;if(!n)return;let a=n.createSVGPoint();a.x=e.clientX,a.y=e.clientY;let l=a.matrixTransform((null===(t=n.getScreenCTM())||void 0===t?void 0:t.inverse())||new DOMMatrix);_({type:"pan",startX:l.x,startY:l.y,lastX:l.x,lastY:l.y})},onMouseMove:e=>{var t;if(!k)return;let n=E.current;if(!n)return;let a=n.createSVGPoint();a.x=e.clientX,a.y=e.clientY;let i=a.matrixTransform((null===(t=n.getScreenCTM())||void 0===t?void 0:t.inverse())||new DOMMatrix);if("pan"===k.type){let e=i.x-k.lastX,t=i.y-k.lastY;M.current.updatePan(e,t),_((0,o._)((0,l._)({},k),{lastX:i.x,lastY:i.y}))}else k.type},onMouseUp:P,onMouseLeave:P,onWheel:e=>{var t;e.preventDefault();let n=E.current;if(!n)return;let a=n.createSVGPoint();a.x=e.clientX,a.y=e.clientY;let o=a.matrixTransform((null===(t=n.getScreenCTM())||void 0===t?void 0:t.inverse())||new DOMMatrix),i=e.deltaY<0?1.1:.9;M.current.updateZoom(i,o),N(e=>(0,l._)({},e))},children:(0,a.jsxs)("g",{transform:M.current.toString(),children:[w.edges.map((e,t)=>{let l="M ".concat(e.start.x,",").concat(e.start.y," \n                            C ").concat(e.start.x,",").concat(e.start.y+40," \n                              ").concat(e.end.x,",").concat(e.end.y-40," \n                              ").concat(e.end.x,",").concat(e.end.y);return(0,a.jsxs)("g",{children:[(0,a.jsx)("path",{d:l,stroke:e.from===n?"#3b82f6":"#888",strokeWidth:"2",fill:"none",markerEnd:"url(#arrowhead)"}),e.text&&(0,a.jsx)("text",{x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2-10,textAnchor:"middle",fill:"#555",fontSize:"12",fontWeight:"bold",dominantBaseline:"middle",children:e.text})]},"edge-".concat(t))}),w.nodes.map(e=>(0,a.jsxs)("g",{transform:"translate(".concat(e.x,",").concat(e.y,")"),onClick:()=>{r(e.id),j(!0)},style:{cursor:"pointer"},children:[(0,a.jsx)("rect",{width:e.width,height:e.height,rx:"8",ry:"8",fill:n===e.id?"#bfdbfe":"white",stroke:n===e.id?"#3b82f6":"#ccc",strokeWidth:"2"}),(0,a.jsx)("foreignObject",{x:"10",y:"10",width:e.width-20,height:"20",children:(0,a.jsx)("div",{className:"text-xs font-bold overflow-hidden text-ellipsis",style:{fontFamily:"sans-serif"},children:e.id})}),(0,a.jsx)("line",{x1:"10",y1:"30",x2:e.width-10,y2:"30",stroke:"#eee",strokeWidth:"1"}),(0,a.jsx)("foreignObject",{x:"10",y:"35",width:e.width-20,height:e.height-45,children:(0,a.jsx)("div",{className:"text-xs overflow-hidden",style:{fontFamily:"sans-serif"},children:e.text.length>100?e.text.substring(0,97)+"...":e.text})})]},"node-".concat(e.id))),(0,a.jsx)("defs",{children:(0,a.jsx)("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:(0,a.jsx)("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#888"})})})]})})}),p&&W&&(0,a.jsxs)("div",{className:"w-96 bg-white overflow-y-auto p-4 border-l",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-medium",children:"Edit Page"}),(0,a.jsx)("button",{onClick:()=>j(!1),className:"text-gray-500 hover:text-gray-700",children:(0,a.jsx)(m,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Page ID"}),(0,a.jsx)("input",{type:"text",value:W.id,onChange:e=>Y(W.id,e.target.value),className:"w-full p-2 border rounded"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Text Content"}),(0,a.jsx)("textarea",{value:W.text,onChange:e=>T(e.target.value),className:"w-full p-2 border rounded min-h-32",rows:5})]}),(0,a.jsxs)("div",{className:"border-t pt-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Navigation"}),!W.options&&(0,a.jsxs)("button",{onClick:L,className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded flex items-center",children:[(0,a.jsx)(h,{className:"w-4 h-4 mr-1"}),"Add Options"]})]}),W.options?(0,a.jsxs)("div",{className:"space-y-3",children:[W.options.map((t,n)=>(0,a.jsxs)("div",{className:"flex items-center space-x-2 p-2 bg-gray-50 rounded",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"Option Text"}),(0,a.jsx)("input",{type:"text",value:t.text,onChange:e=>D(n,"text",e.target.value),className:"w-full p-2 border rounded"})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"Next Page"}),(0,a.jsxs)("select",{value:t.next,onChange:e=>D(n,"next",e.target.value),className:"w-full p-2 border rounded",children:[(0,a.jsx)("option",{value:"",children:"Select next page..."}),e.dialog.page.map(e=>(0,a.jsx)("option",{value:e.id,children:e.id},e.id))]})]}),(0,a.jsx)("button",{onClick:()=>R(n),className:"text-red-600 hover:text-red-800 p-1",children:(0,a.jsx)(m,{className:"w-4 h-4"})})]},n)),(0,a.jsxs)("button",{onClick:L,className:"bg-gray-200 hover:bg-gray-300 px-3 py-2 rounded flex items-center",children:[(0,a.jsx)(h,{className:"w-4 h-4 mr-1"}),"Add Option"]})]}):(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Next Page:"}),(0,a.jsxs)("select",{value:W.next||"",onChange:e=>A(e.target.value),className:"p-2 border rounded flex-1",children:[(0,a.jsx)("option",{value:"",children:"Select next page..."}),e.dialog.page.map(e=>(0,a.jsx)("option",{value:e.id,disabled:e.id===W.id,children:e.id},e.id))]})]})]}),(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t flex justify-between",children:[(0,a.jsxs)("button",{onClick:()=>X(W.id),className:"bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded flex items-center",children:[(0,a.jsx)(f,{className:"w-4 h-4 mr-1"}),"Delete Page"]}),(0,a.jsx)("button",{onClick:()=>j(!1),className:"bg-gray-200 hover:bg-gray-300 px-3 py-2 rounded",children:"Done"})]})]})]})]})]})}var w=()=>(0,a.jsx)(j,{})}},function(e){e.O(0,[888,774,179],function(){return e(e.s=43)}),_N_E=e.O()}]);